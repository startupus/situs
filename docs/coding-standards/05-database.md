# База данных (Prisma/TypeORM)

Назначение: стандарты моделирования данных, миграций и транзакций.

## Чеклист реализации
- [x] Именование моделей и полей (PascalCase/camelCase)
- [x] Миграции: стратегия для Prisma/TypeORM, порядок применения
- [x] Транзакции и согласованность данных
- [x] Индексы и ограничения
- [x] Сидирование и демо-данные
- [x] Версионирование схем и синхронизация (schema:sync)

## Именование
- Модели (Prisma) — `PascalCase` в единственном числе (`User`, `MenuItem`). Поля — `camelCase`.
- В TypeORM сущности именовать аналогично; таблицы — snake_case через настройки/модели по необходимости.

## Миграции и схема
- Источник истины — `prisma/schema.prisma`.
- Синхронизация в backend: `npm run schema:sync` (см. `scripts/schema-sync.sh`), копирует в `backend/prisma/schema.prisma` и валидирует.
- Применение изменений: `npx prisma db push` для dev, `prisma migrate dev/deploy` для миграций.
- Правило: не изменять `backend/prisma/schema.prisma` вручную — только через корневую схему.

## Транзакции
- Использовать транзакции ORM для целостности связанных операций (создание/перемещение меню и т.п.).
- Важные инварианты проверять внутри транзакции (уникальные алиасы, корректность родителя).

## Индексы и ограничения
- Индексы на поля поиска/соединений (например, `projectId`, `parentId`, `slug/alias`).
- Уникальные ограничения на бизнес‑ключи (например, alias в пределах типа меню/проекта).

## Сиды и демо
- Сиды хранить в `prisma/seed*.ts` и `scripts/seed-*.ts`. Запуск: `npm run db:seed`/`db:seed:demo`.
- Отдельные сиды для ACL/групп/меню: см. `prisma/seed-acl.ts`, `scripts/seed-startapus-menus.ts`.

## Версионирование и синхронизация
- При изменении схемы — запускать `npm run schema:sync` и `npx prisma generate`.
- В pre-commit хук включена синхронизация и проверка компиляции — коммит без прохождения проверок невозможен.

## TypeORM
- Если модуль использует TypeORM — фиксировать выбор ORM в README модуля, не смешивать с Prisma внутри одного домена.
- Миграции TypeORM хранить рядом с модулем или в централизованной папке (описать в README), применять через `typeorm migration:run`.

## Навигация
Назад: `./README.md`