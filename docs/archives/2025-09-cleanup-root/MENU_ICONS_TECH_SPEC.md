# Техническое задание: Добавление React иконок в систему меню

## 📋 Анализ текущей системы

### Текущая архитектура меню:

- **База данных**: Модели `MenuType` и `MenuItem` в Prisma
- **Типы**: TypeScript интерфейсы в `src/types/menu.ts`
- **API**: NestJS контроллеры в `src/server/menus/`
- **Frontend**: React компоненты в `src/components/admin/menu/`
- **Зависимости**: `react-icons@5.5.0` уже установлена

### Проблема:

В текущей системе меню отсутствует поддержка иконок, что создает проблемы навигации в сайдбаре проектов. Пункты меню отображаются только с эмодзи-иконками (`getItemIcon()` в `SiteMenuSettings.tsx`).

## 🎯 Цели и требования

### Основные цели:

1. **Добавить поле иконки** в модель `MenuItem`
2. **Создать селектор React иконок** для выбора иконок из коллекции
3. **Обновить UI компоненты** для поддержки иконок
4. **Обеспечить обратную совместимость** с существующими пунктами меню

### Функциональные требования:

- ✅ Выбор иконки из коллекции React Icons (Feather Icons - Fi)
- ✅ Предварительный просмотр иконки в реальном времени
- ✅ Поиск иконок по названию
- ✅ Категоризация иконок (общие, навигация, e-commerce, etc.)
- ✅ Сохранение выбранной иконки в базе данных
- ✅ Отображение иконок в сайдбаре проекта
- ✅ Fallback на дефолтные иконки при отсутствии выбранной

## 🗄️ Изменения в базе данных

### 1. Обновление модели MenuItem

```prisma
model MenuItem {
  // ... существующие поля ...

  // Новое поле для иконки
  icon        String?      // Название React иконки (например: "FiHome", "FiUsers")
  iconLibrary String?      @default("fi") // Библиотека иконок (fi, fa, md, etc.)

  // ... остальные поля ...
}
```

### 2. Миграция базы данных

- Добавить поля `icon` и `iconLibrary` в таблицу `menu_items`
- Установить значения по умолчанию для существующих записей

## 🔧 Изменения в TypeScript типах

### 1. Обновление интерфейса MenuItemData

```typescript
export interface MenuItemData {
  // ... существующие поля ...

  // Новые поля для иконок
  icon?: string; // "FiHome", "FiUsers", "FiShoppingCart"
  iconLibrary?: string; // "fi", "fa", "md", "hi"

  // ... остальные поля ...
}
```

### 2. Обновление DTOs

```typescript
// В CreateMenuItemDto и UpdateMenuItemDto
@IsOptional()
@IsString()
@MaxLength(50)
icon?: string;

@IsOptional()
@IsString()
@MaxLength(10)
iconLibrary?: string = 'fi';
```

## 🎨 Новые UI компоненты

### 1. IconSelector компонент

**Файл**: `src/components/admin/menu/IconSelector.tsx`

**Функциональность**:

- Отображение сетки доступных иконок
- Поиск по названию иконки
- Категоризация иконок
- Предварительный просмотр выбранной иконки
- Поддержка разных библиотек иконок

**Категории иконок**:

- **Общие**: FiHome, FiUser, FiSettings, FiInfo
- **Навигация**: FiMenu, FiArrowRight, FiChevronDown, FiCompass
- **E-commerce**: FiShoppingCart, FiShoppingBag, FiCreditCard, FiTruck
- **Контент**: FiFileText, FiImage, FiVideo, FiMusic
- **Социальные**: FiMail, FiPhone, FiMessageCircle, FiShare

### 2. IconPreview компонент

**Файл**: `src/components/admin/menu/IconPreview.tsx`

**Функциональность**:

- Рендеринг иконки по названию
- Fallback на дефолтную иконку
- Поддержка разных размеров
- Темная/светлая тема

## 📝 Обновления существующих компонентов

### 1. CreateMenuItemModal.tsx

- Добавить поле выбора иконки
- Интегрировать IconSelector
- Добавить предварительный просмотр

### 2. EditMenuItemModal.tsx

- Добавить возможность изменения иконки
- Показать текущую иконку
- Кнопка "Удалить иконку"

### 3. MenuItemCard.tsx

- Отображать выбранную иконку вместо эмодзи
- Fallback на дефолтную иконку

### 4. SiteMenuSettings.tsx

- Заменить `getItemIcon()` на React иконки
- Добавить поддержку иконок в модальное окно добавления

## 🔄 Обновления API

### 1. Контроллеры

- Обновить валидацию в `CreateMenuItemDto`
- Добавить поддержку новых полей в API ответах

### 2. Сервисы

- Обновить методы создания и обновления пунктов меню
- Добавить валидацию существования иконок

## 🎯 Пользовательский интерфейс

### 1. Селектор иконок

```
┌─────────────────────────────────────┐
│ 🔍 Поиск иконок...                  │
├─────────────────────────────────────┤
│ 📂 Общие  📍 Навигация  🛒 E-commerce│
├─────────────────────────────────────┤
│ [🏠] [👤] [⚙️] [ℹ️] [📄] [📷]      │
│ [🔗] [📊] [💰] [🛍️] [📧] [📞]      │
│                                     │
│ Выбрано: FiHome                     │
│ Предварительный просмотр: [🏠]       │
└─────────────────────────────────────┘
```

### 2. Отображение в списке пунктов меню

```
┌─────────────────────────────────────┐
│ [🏠] Главная страница               │
│ [👤] О нас                          │
│ [🛍️] Каталог товаров               │
│ [📞] Контакты                       │
└─────────────────────────────────────┘
```

## 📋 План реализации

### Этап 1: Подготовка базы данных

1. ✅ Создать миграцию Prisma для добавления полей `icon` и `iconLibrary`
2. ✅ Обновить схему Prisma
3. ✅ Запустить миграцию

### Этап 2: Обновление типов и API

1. ✅ Обновить TypeScript интерфейсы
2. ✅ Обновить DTOs для валидации
3. ✅ Обновить API контроллеры

### Этап 3: Создание UI компонентов

1. ✅ Создать `IconSelector` компонент
2. ✅ Создать `IconPreview` компонент
3. ✅ Создать коллекцию доступных иконок

### Этап 4: Интеграция в существующие компоненты

1. ✅ Обновить `CreateMenuItemModal`
2. ✅ Обновить `EditMenuItemModal`
3. ✅ Обновить `MenuItemCard`
4. ✅ Обновить `SiteMenuSettings`

### Этап 5: Тестирование и финализация

1. ✅ Тестирование создания пунктов с иконками
2. ✅ Тестирование редактирования иконок
3. ✅ Тестирование отображения в сайдбаре
4. ✅ Проверка обратной совместимости

## 🎨 Дизайн-система иконок

### Поддерживаемые библиотеки:

- **Feather Icons (Fi)** - основная (уже используется в проекте)
- **Font Awesome (Fa)** - дополнительная
- **Material Design (Md)** - дополнительная

### Размеры иконок:

- **Маленькие**: 16px (в списках)
- **Средние**: 20px (в карточках)
- **Большие**: 24px (в заголовках)

### Цветовая схема:

- **Активные**: `text-primary`
- **Неактивные**: `text-body-color dark:text-dark-6`
- **Hover**: `hover:text-primary`

## 🔒 Безопасность и валидация

### Валидация иконок:

- Проверка существования иконки в библиотеке
- Санитизация названий иконок
- Ограничение на поддерживаемые библиотеки

### Fallback стратегия:

- При отсутствии иконки - показать дефолтную
- При ошибке загрузки - показать текстовую метку
- Логирование ошибок для мониторинга

## 📊 Метрики и мониторинг

### Отслеживаемые метрики:

- Количество пунктов меню с иконками
- Популярные иконки
- Ошибки загрузки иконок
- Время отклика селектора иконок

## 🚀 Развертывание

### Этапы развертывания:

1. **Миграция БД** - обновление схемы
2. **Backend** - обновление API
3. **Frontend** - обновление компонентов
4. **Тестирование** - проверка функциональности
5. **Продакшн** - развертывание обновлений

### Rollback план:

- Поля иконок опциональны - не ломают существующую функциональность
- Возможность отката миграции БД
- Сохранение старых компонентов как fallback

## ✅ Критерии приемки

### Функциональные:

- [ ] Пользователь может выбрать иконку при создании пункта меню
- [ ] Пользователь может изменить иконку существующего пункта
- [ ] Иконки отображаются в сайдбаре проекта
- [ ] Поиск иконок работает корректно
- [ ] Предварительный просмотр иконок работает

### Технические:

- [ ] Миграция БД выполнена успешно
- [ ] API тесты проходят
- [ ] UI тесты проходят
- [ ] Производительность не ухудшилась
- [ ] Обратная совместимость сохранена

### UX:

- [ ] Интуитивно понятный интерфейс выбора иконок
- [ ] Быстрый поиск и фильтрация
- [ ] Адаптивный дизайн на всех устройствах
- [ ] Поддержка темной и светлой темы

---

**Примерное время реализации**: 2-3 дня
**Приоритет**: Высокий (улучшение UX навигации)
**Риски**: Минимальные (обратная совместимость обеспечена)
