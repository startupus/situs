# Решение проблемы изоляции тем в редакторе Redaktus

## Проблема

Изначально в редакторе была проблема с тем, что темы административного интерфейса влияли на темы контента сайта в канвасе. Это происходило из-за:

1. **Глобального применения тем** к `document.documentElement`
2. **Наследования стилей** от родительских контейнеров
3. **Конфликта CSS переменных** между интерфейсом и канвасом

## Архитектурное решение

Создана **полностью изолированная система тем** с четким разделением:

### 1. Изолированные хуки тем

#### `useInterfaceTheme` - тема интерфейса редактора
- Управляет только интерфейсом редактора
- Применяет темы к контейнерам `.redaktus-interface` и `.redaktus-admin`
- НЕ влияет на канвас или контент сайта

#### `useCanvasTheme` - изолированная тема канваса
- Полностью изолированная тема для канваса
- Использует CSS-in-JS подход для полного контроля
- Применяет темы только к контейнеру `.redaktus-canvas`

### 2. CSS изоляция

#### `src/styles/interface-themes.css`
- Стили для интерфейса редактора
- Использует CSS переменные с префиксом `--interface-*`
- Изоляция через `isolation: isolate`

#### `src/styles/canvas-themes.css`
- Полностью изолированные стили для канваса
- Использует CSS переменные с префиксом `--canvas-*`
- Принудительная изоляция через `all: initial` и `contain: layout style paint`

### 3. Структура контейнеров

```html
<div class="redaktus-interface" data-interface-theme="dark">
  <!-- Интерфейс редактора с темной темой -->
  
  <div class="redaktus-canvas" data-canvas-theme="light" data-canvas-isolated="true">
    <!-- Канвас с изолированной светлой темой -->
    <!-- Контент сайта не зависит от темы интерфейса -->
  </div>
</div>
```

## Ключевые принципы

### 1. Никаких глобальных стилей
- Темы применяются только к конкретным контейнерам
- Нет влияния на `document.documentElement`

### 2. CSS-in-JS изоляция
- Стили создаются динамически через JavaScript
- Полный контроль над применением тем

### 3. Префиксные CSS переменные
- `--interface-*` для интерфейса
- `--canvas-*` для канваса
- `--project-*` для настроек проекта

### 4. Независимые контексты
- Каждый тип темы управляется отдельно
- Нет конфликтов между темами

## Результат

✅ **Интерфейс редактора** может быть темным, а **канвас** светлым  
✅ **Канвас** может быть темным, а **интерфейс** светлым  
✅ **Настройки проекта** не влияют на интерфейс редактора  
✅ **Контент сайта** полностью изолирован от админки  

## Использование

### Переключение темы интерфейса
```typescript
const { theme: interfaceTheme, toggleTheme: toggleInterfaceTheme } = useInterfaceTheme();
```

### Переключение темы канваса
```typescript
const { theme: canvasTheme, toggleTheme: toggleCanvasTheme } = useCanvasTheme();
```

### В компонентах
```typescript
// Кнопка переключения темы интерфейса
<button onClick={toggleInterfaceTheme}>
  Переключить тему интерфейса
</button>

// Кнопка переключения темы канваса
<button onClick={toggleCanvasTheme}>
  Переключить тему канваса
</button>
```

## Файлы решения

- `src/hooks/useInterfaceTheme.ts` - хук для темы интерфейса
- `src/hooks/useCanvasTheme.ts` - изолированный хук для темы канваса
- `src/styles/interface-themes.css` - CSS для тем интерфейса
- `src/styles/canvas-themes.css` - изолированные CSS для тем канваса
- `src/components/tailgrids/CanvasToolbar.tsx` - обновленный тулбар с двумя кнопками тем

## Тестирование

1. Переключите интерфейс на темную тему - канвас остается светлым
2. Переключите канвас на темную тему - интерфейс остается светлым
3. Настройки проекта не влияют на интерфейс редактора
4. Контент сайта полностью изолирован от админки

## Преимущества решения

1. **Архитектурная чистота** - четкое разделение ответственности
2. **Полная изоляция** - темы не влияют друг на друга
3. **Масштабируемость** - легко добавлять новые типы тем
4. **Производительность** - CSS-in-JS подход для оптимизации
5. **Поддерживаемость** - понятная структура и документация
