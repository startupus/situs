# Стандарты Playwright в проекте

Этот документ фиксирует терминологию и правила для e2e‑тестов фронтенда через браузер.

## Термины
- **Playwright**: фреймворк для автоматизации браузера (Chromium/Firefox/WebKit).
- **Playwright Test**: встроенный раннер тестов Playwright и конфигурация `playwright.config.ts`.
- **webServer**: секция конфигурации, которая поднимает dev‑серверы перед тестами.
- **baseURL**: базовый URL фронтенда, к которому обращаются тесты (у нас `http://localhost:5177`).
- **project**: профили окружений браузера (например, `chromium`).
- **trace/screenshot/video**: артефакты диагностики падений тестов.

## Порты и процессы
- Frontend (Vite): `5177` (строгий порт, `strictPort: true`).
- Backend (NestJS): `3001`.
- HMR: `24678`.

Если порт занят — процесс должен быть остановлен, затем перезапущен на зафиксированном порту. Автоматические попытки смены порта запрещены в тестовой среде.

## Структура
- Конфиг: корень репозитория — `playwright.config.ts`.
- Тесты e2e: `tests/e2e/**/*.spec.ts`.
- Визуальные тесты: `tests/visual/**/*.spec.ts` (отдельный конфиг: `playwright-visual.config.ts`).

## Скрипты npm
- `dev:api` — NestJS (порт 3001).
- `dev:situs` — Vite (порт 5177, strictPort=true).
- `dev:full` — параллельно frontend + backend (для локальной разработки).
- `test:e2e` — запуск Playwright.

Рекомендуемый порядок локального прогона: сначала запустить `dev:full`, затем `test:e2e`.

## Конвенции тестов
- Использовать селекторы по ролям и aria‑меткам (`getByRole`, `getByLabel`) либо data‑атрибуты `data-testid`.
- Не полагаться на локаторы, завязанные на случайный текст/классы Tailwind.
- Отключать лишние сети/таймеры в тестах (debounce/анимации) при необходимости.

## Отладка
- `PWDEBUG=1` или `npx playwright test --debug` — инспектор.
- Артефакты падений см. в `test-results/`.

## Примечания
- Для e2e запрещено использовать Jest. Все браузерные тесты — только Playwright Test.
- MCP Browser Tools допускается использовать как вспомогательный инструмент мониторинга, но эталон проверок — Playwright.
