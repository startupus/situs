#!/bin/bash

# Git pre-commit hook –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞
# –ü—Ä–æ–≤–µ—Ä—è–µ—Ç TypeScript, Prisma —Å—Ö–µ–º—É –∏ –¥—Ä—É–≥–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã

echo "üîç Pre-commit checks..."

# –¶–≤–µ—Ç–∞
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

log_error() {
    echo -e "${RED}[ERROR]${NC} $1"
}

log_success() {
    echo -e "${GREEN}[SUCCESS]${NC} $1"
}

log_info() {
    echo -e "${YELLOW}[INFO]${NC} $1"
}

# 1. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è Prisma —Å—Ö–µ–º—ã
log_info "Syncing Prisma schemas..."
if ! npm run schema:sync; then
    log_error "Schema sync failed"
    exit 1
fi

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
log_info "Running development safety checks..."
if ! npm run dev:safe -- --check-only; then
    log_error "Development safety checks failed"
    exit 1
fi

log_success "All pre-commit checks passed! ‚úÖ"