#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
# –£–±–µ–∂–¥–∞–µ—Ç—Å—è —á—Ç–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö..."

# –ü–æ–¥—Å—á–µ—Ç .db —Ñ–∞–π–ª–æ–≤ –≤ –ø—Ä–æ–µ–∫—Ç–µ
db_count=$(find . -name "*.db" -not -path "./node_modules/*" | wc -l | tr -d ' ')

echo "üìä –ù–∞–π–¥–µ–Ω–æ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö: $db_count"

if [ $db_count -eq 0 ]; then
    echo "‚ùå –û–®–ò–ë–ö–ê: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!"
    echo "   –û–∂–∏–¥–∞–µ—Ç—Å—è: prisma/dev.db"
    exit 1
elif [ $db_count -eq 1 ]; then
    db_file=$(find . -name "*.db" -not -path "./node_modules/*")
    if [ "$db_file" = "./prisma/dev.db" ]; then
        echo "‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –ø–æ—Ä—è–¥–∫–µ: $db_file"
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        echo "üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö:"
        sqlite3 prisma/dev.db "
        SELECT '–ü—Ä–æ–µ–∫—Ç—ã: ' || COUNT(*) FROM projects;
        SELECT '–¢–∏–ø—ã –º–µ–Ω—é: ' || COUNT(*) FROM menu_types;
        SELECT '–ü—É–Ω–∫—Ç—ã –º–µ–Ω—é: ' || COUNT(*) FROM menu_items;
        SELECT '–ü—Ä–æ–¥—É–∫—Ç—ã: ' || COUNT(*) FROM products;
        SELECT '–°—Ç—Ä–∞–Ω–∏—Ü—ã: ' || COUNT(*) FROM pages;
        "
        
        echo "‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ"
        exit 0
    else
        echo "‚ùå –û–®–ò–ë–ö–ê: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –º–µ—Å—Ç–µ: $db_file"
        echo "   –û–∂–∏–¥–∞–µ—Ç—Å—è: ./prisma/dev.db"
        exit 1
    fi
else
    echo "‚ùå –û–®–ò–ë–ö–ê: –ù–∞–π–¥–µ–Ω–æ $db_count –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö. –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞!"
    echo "   –ù–∞–π–¥–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:"
    find . -name "*.db" -not -path "./node_modules/*" | while read file; do
        echo "   - $file"
    done
    echo ""
    echo "üîß –î–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:"
    echo "   1. –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –∫–∞–∫–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–¥–µ—Ä–∂–∏—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ"
    echo "   2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –µ—ë –≤ prisma/dev.db"
    echo "   3. –£–¥–∞–ª–∏—Ç–µ –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ .db —Ñ–∞–π–ª—ã"
    echo "   4. –û–±–Ω–æ–≤–∏—Ç–µ DATABASE_URL –≤ .env"
    exit 1
fi
